#!/ usr / bin / env python3
from pwn import *
context .arch = ’i386 ’
sig = bytearray ([235 , 98, 85, 139 , 236 , 131 , 236 , 24, 139 , 125 , 16, 139 , 117 ,
12, 51, 192 , 137 , 69, 252 , 139 , 200 , 131 , 225 , 3, 3, 201 , 3, 201 , 3,
201 , 139 , 218 , 211 , 251 , 138 , 203 , 51, 219 , 57, 93, 20, 117 , 24, 15,
182 , 30, 15, 182 , 201 , 51, 217 , 139 , 77, 8, 15, 182 , 12, 8, 59, 217 ,
117 , 7, 255 , 69, 252 , 235 , 2, 48, 14, 64, 70, 59, 199 , 124 , 200 , 59,
125 , 252 , 116 , 16, 131 , 125 , 20, 1, 116 , 6, 66, 131 , 250 , 255 , 114 , 175 ,
51, 192 , 235 , 2, 139 , 194 , 201 , 195 , 85, 139 , 236 , 131 , 236 , 16, 235 ,
80, 88, 137 , 69, 252 , 235 , 55, 88, 139 , 16, 137 , 85, 248 , 131 , 192 , 4,
137 , 69, 244 , 51, 219 , 51, 192 , 80, 106 , 10, 255 , 117 , 252 , 255 , 117 ,
244 , 232 , 114 , 255 , 255 , 255 , 133 , 192 , 116 , 19, 106 , 1, 255 , 117 , 248 ,
255 , 117 , 252 , 255 , 117 , 244 , 232 , 94, 255 , 255 , 255 , 255 , 101 , 252 ,
201 , 195 , 232 , 196 , 255 , 255 , 255])
forfinsys.argv[1:]:
	print("analysing",f)
	d=read(f)
	o=d.find(sig)
	ifo!=-1:
		sz=u32(d[o+0xae:o+0xae+4])
		print("foundatoffset0x{:x},size{}".format(o,sz))
		sc=d[o+0xc1:o+0xc1+sz]
		key=xor(d[o+0xb2:o+0xb2+4],sc,cut=’min’)
		print("key{0}(0x{0:x})".format(u32(key)))
		sc=xor(key,sc)
		print(hexdump(sc,hexii=True))
		print(sc)
		print(disasm(sc))